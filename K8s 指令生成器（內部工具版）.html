<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>K8s æŒ‡ä»¤ç”Ÿæˆå™¨ï¼ˆé€²éšç‰ˆï¼‰</title>
<style>


body {
  font-family: monospace;
  background: #f6f6f6;
  padding: 20px;
  width: min(900px, 100%);
  margin: auto;
}
h2 { margin-top: 0; }
textarea, input, select {
  width: 100%;
  padding: 6px;
  margin-bottom: 8px;
  font-family: monospace;
}
textarea { height: 60px; }
button {
  padding: 6px 12px;
  margin-right: 6px;
  cursor: pointer;
}
.var-block {
  border: 1px solid #ccc;
  padding: 10px;
  margin-bottom: 10px;
  background: #fff;
}
.safe { color: green; font-weight: bold; }
.danger { color: red; font-weight: bold; }
pre {
  background: #111;
  color: #0f0;
  padding: 12px;
  max-height: 300px;
  overflow: auto;
}

/* è®Šæ•¸å¡ç‰Œå®¹å™¨ */
#vars {
  display: flex;
  flex-wrap: wrap;          /* æ»¿äº†è‡ªå‹•æ›è¡Œ */
  gap: 12px;                /* å¡ç‰Œé–“è· */
  align-items: flex-start;
}

/* å–®ä¸€è®Šæ•¸å¡ç‰Œ */
.var-block {
  width: 240px;             /* å¡ç‰Œå¯¬åº¦ï¼Œå¯èª¿ */
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 10px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.08);
}

/* å¡ç‰Œå…§ input / textarea å¾®èª¿ */
.var-block input,
.var-block textarea {
  width: 100%;
  box-sizing: border-box;
  font-family: monospace;
}

/* åˆªé™¤æŒ‰éˆ•é å³ */
.var-block button {
  margin-top: 6px;
  float: right;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}


.layout {
  display: flex;
  gap: 20px;
}

.section {
  position: relative;
  padding-top: 16px;
}

.section::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: #ddd;
}

.left {
  flex: 1;
}

.right {
  flex: 1;
}



</style>
</head>
<body>

<h2>ğŸ”§ K8s æŒ‡ä»¤ç”Ÿæˆå™¨ï¼ˆå…§éƒ¨å·¥å…·ç‰ˆï¼‰</h2>
<hr>
<div class="layout">
  <div class="section left">

<label>ğŸ“¦ å¸¸ç”¨æŒ‡ä»¤æ¨¡æ¿</label>
<select id="templateSelect" onchange="applyTemplate()">
  <option value="">â€” è‡ªè¨‚ â€”</option>
  <option value="kubectl rollout restart deployment ${deployment} -n ${ns}" data-risk="danger">
    é‡æ–°éƒ¨ç½²rollout restartï¼ˆâš ï¸å½±éŸ¿ç·šä¸Šï¼‰
  </option>
 <option value="kubectl rollout restart deployment gocron-${ns} -n gocron" data-risk="danger">
    é‡æ–°éƒ¨ç½²gocron - rollout restartï¼ˆâš ï¸å½±éŸ¿ç·šä¸Šï¼‰
  </option>
  <option value="kubectl scale deployment ${deployment} --replicas=${replicas} -n ${ns}" data-risk="danger">
    scaleï¼ˆâš ï¸å½±éŸ¿ç·šä¸Šï¼‰
  </option>
  <option value="kubectl delete pod ${pod} -n ${ns}" data-risk="danger">
    delete podï¼ˆâš ï¸å½±éŸ¿ç·šä¸Šï¼‰
  </option>
  <option value="kubectl delete deployment ${deployment} -n ${ns}" data-risk="danger">
    delete deploy ï¼ˆâš ï¸å½±éŸ¿ç·šä¸Šï¼‰
  </option>
  <option value="kubectl rollout undo deploy ${deployment} -n ${ns}" data-risk="danger">
    å›æ»¾ä¸Šä¸€å€‹æˆåŠŸçš„ç‰ˆæœ¬ ï¼ˆâš ï¸å½±éŸ¿ç·šä¸Šï¼‰
  </option>
  <option value="kubectl get pods -n ${ns}" data-risk="safe">
    get podsï¼ˆâœ…å®‰å…¨ï¼‰
  </option>
  <option value="kubectl describe deployment ${deployment} -n ${ns}" data-risk="safe">
    describe deploymentï¼ˆâœ…å®‰å…¨ï¼‰
  </option>
  <option value="kubectl get deploy -n ${ns}" data-risk="safe">
    get deployï¼ˆâœ…å®‰å…¨ï¼‰
  </option>
  <option value="kkubectl rollout status deploy ${deploy} -n ${ns}" data-risk="safe">
    rollout status deployçœ‹éƒ¨ç½²ç‹€æ…‹ï¼ˆâœ…å®‰å…¨ï¼‰
  </option>
</select>






<label>âœï¸ æŒ‡ä»¤æ¨¡æ¿</label>
<textarea id="template"></textarea>
<div id="riskNote"></div>
 </div>

  <div class="section right">


<div class="card">
  <label>æŒ‡ä»¤é¡å‹</label>
  <select id="commandType" onchange="updateDescription()">
    <option value="rollout">rollout restart</option>
    <option value="scale">scale</option>
    <option value="delete">delete deployment</option>
    <option value="delete2">delete deployment</option>
  </select>


  <p id="commandDesc" style="margin-top:8px;font-size:13px;color:#555;"></p>
</div>

 </div>
</div>

<hr>
<h3>ğŸ”£ è®Šæ•¸è¨­å®š</h3>
<button onclick="addVar()">â• æ–°å¢è®Šæ•¸</button>
<hr>
<div id="vars"></div>




<label>ğŸ”€ çµ„åˆæ–¹å¼</label>
<select id="mode">
  <option value="cross">æ’åˆ—çµ„åˆï¼ˆå…¨éƒ¨çµ„åˆï¼‰</option>
  <option value="zip">ä¸€å°ä¸€å°æ‡‰</option>
</select>

<br><br>
<button onclick="generate()">ğŸš€ ç”¢ç”ŸæŒ‡ä»¤</button>
<button onclick="copy()">ğŸ“‹ è¤‡è£½çµæœ</button>

<h3>ğŸ“¤ ç”¢ç”Ÿçµæœ</h3>
<pre id="output"></pre>



<script>

  const commandMeta = {
    rollout: {
      template: (dep, ns) =>
        `kubectl --kubeconfig=config rollout restart deployment ${dep} -n ${ns}`,
      desc: 'é‡æ–°å•Ÿå‹• Deployment çš„ Podsï¼ˆä¸ä¸­æ–·æœå‹™ï¼Œä½†æœƒé‡å»º Podsï¼‰'
    },
    scale: {
      template: (dep, ns) =>
        `kubectl --kubeconfig=config scale deployment ${dep} --replicas=3 -n ${ns}`,
      desc: 'èª¿æ•´ Deployment å‰¯æœ¬æ•¸ï¼Œæœƒç«‹å³å½±éŸ¿æœå‹™æ‰¿è¼‰é‡'
    },
    delete: {
      template: (dep, ns) =>
        `kubectl --kubeconfig=config delete deployment ${dep} -n ${ns}`,
      desc: 'åˆªé™¤æŒ‡å®š Deploymentï¼ˆä¸å¯å›å¾©ï¼‰'
    },

        delete2: {
      template: (dep, ns) =>
        `kubectl --kubeconfig=config delete deployment ${dep} -n ${ns}`,
      desc: 'åˆªé™¤æŒ‡å®š Deploymentï¼ˆä¸å¯å›å¾©ï¼‰'
    }
  };

  function updateDescription() {
    const type = document.getElementById('commandType').value;
    document.getElementById('commandDesc').innerText =
      commandMeta[type].desc;
  }

  updateDescription(); // é è¨­é¡¯ç¤º


function addVar(name = '', value = '') {
  const div = document.createElement('div');
  div.className = 'var-block';
  div.innerHTML = `
    <label>è®Šæ•¸åç¨±</label>
    <input placeholder="ä¾‹å¦‚ ns / deployment" value="${name}">
    <label>è®Šæ•¸å€¼</label>
    <textarea placeholder="æ”¯æ´ é€—è™Ÿ / ç©ºæ ¼ / æ›è¡Œ">${value}</textarea>
    <button onclick="this.parentNode.remove()">âŒ åˆªé™¤</button>
  `;
  document.getElementById('vars').appendChild(div);
}

  function splitInput(text) {
    return text
      .split(/[\s,]+/)
      .map(v => v.trim())
      .filter(Boolean);
  }

function cartesian(arrays) {
  return arrays.reduce((a, b) =>
    a.flatMap(x => b.map(y => x.concat([y]))), [[]]);
}

function generate() {
  const template = document.getElementById('template').value;
  const blocks = document.querySelectorAll('.var-block');
  const names = [];
  const values = [];
  

  blocks.forEach(b => {
    const n = b.querySelector('input').value;
    const v = splitInput(b.querySelector('textarea').value);
    if (n && v.length) {
      names.push(n);
      values.push(v);
    }
  });

  let results = [];
  const mode = document.getElementById('mode').value;

  if (mode === 'cross') {
    const combos = cartesian(values);
    combos.forEach(c => {
      let cmd = template;
      c.forEach((val, i) => {
        cmd = cmd.replace(new RegExp(`\\$\\{${names[i]}\\}`, 'g'), val);
      });
      results.push(cmd);
    });
  } else {
    const len = Math.min(...values.map(v => v.length));
    for (let i = 0; i < len; i++) {
      let cmd = template;
      names.forEach((n, idx) => {
        cmd = cmd.replace(new RegExp(`\\$\\{${n}\\}`, 'g'), values[idx][i]);
      });
      results.push(cmd);
    }
  }

  document.getElementById('output').textContent = results.join('\n');
}

function copy() {
  navigator.clipboard.writeText(
    document.getElementById('output').textContent
  );
  alert('å·²è¤‡è£½');
}

function applyTemplate() {
  const sel = document.getElementById('templateSelect');
  const opt = sel.options[sel.selectedIndex];
  document.getElementById('template').value = opt.value || '';

  const risk = opt.dataset.risk;
  const note = document.getElementById('riskNote');
  if (risk === 'danger') {
    note.innerHTML = '<p class="danger">âš ï¸ æ­¤æŒ‡ä»¤æœƒå¯¦éš›å½±éŸ¿ç·šä¸Šè³‡æºï¼Œè«‹ç¢ºèªå¾Œå†åŸ·è¡Œ</p>';
  } else if (risk === 'safe') {
    note.innerHTML = '<p class="safe">âœ… æ­¤æŒ‡ä»¤ç‚ºåªè®€æ“ä½œï¼Œä¸æœƒå½±éŸ¿ç·šä¸Š</p>';
  } else {
    note.innerHTML = '';
  }
   syncVarsFromTemplate();
}


//
function syncVarsFromTemplate() {
  //å…ˆæ¸…ç©º
  vars.innerHTML='';
  const template = document.getElementById('template').value;
  if (!template) return;

  // 1. æŠ“å‡º ${xxx}
  const matches = [...template.matchAll(/\$\{(\w+)\}/g)];
  const varsInTemplate = [...new Set(matches.map(m => m[1]))];

  // 2. ç›®å‰å·²å­˜åœ¨çš„è®Šæ•¸
  const existingVars = Array.from(
    document.querySelectorAll('.var-block input')
  ).map(input => input.value);

  // 3. æ–°çš„æ‰åŠ 
  varsInTemplate.forEach(v => {
    if (!existingVars.includes(v)) {
      addVar(v);
    }
  });
}
//


</script>

</body>
</html>
