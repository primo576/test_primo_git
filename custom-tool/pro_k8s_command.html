<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>K8s æŒ‡ä»¤ç”Ÿæˆå™¨ï¼ˆé€²éšç‰ˆï¼‰</title>

  <script src="pro-k8s-command-config.js"></script>

  <style>
    body {
      font-family: monospace;
      background: #f6f6f6;
      padding: 20px;
      width: min(900px, 100%);
      margin: auto;
    }

    h2 {
      margin-top: 0;
    }

    textarea,
    input,
    select {
      width: 100%;
      padding: 6px;
      margin-bottom: 8px;
      font-family: monospace;
    }

    textarea {
      height: 60px;
    }

    button {
      padding: 6px 12px;
      margin-right: 6px;
      cursor: pointer;
    }

    .safe {
      color: green;
      font-weight: bold;
    }

    .danger {
      color: red;
      font-weight: bold;
    }

    pre {
      background: #111;
      color: #0f0;
      padding: 12px;
      max-height: 300px;
      overflow: auto;
    }

    /* Layout */
    .layout {
      display: flex;
      gap: 20px;
    }

    .left,
    .right {
      flex: 1;
    }

    .section {
      position: relative;
      padding-top: 16px;
    }

    .section::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: #ddd;
    }

    /* Vars */
    #vars {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: flex-start;
    }

    .var-block {
      width: 240px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
    }

    .var-block input,
    .var-block textarea {
      width: 100%;
      box-sizing: border-box;
      font-family: monospace;
    }

    .var-block button {
      margin-top: 6px;
      float: right;
      background: #f5f5f5;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <div class="layout">
    <div class="section left">
      <h2>ğŸ”§ K8s æŒ‡ä»¤ç”Ÿæˆå™¨ï¼ˆå…§éƒ¨å·¥å…·ç‰ˆï¼‰</h2>
    </div>
    <div class="section right">
      <select id="templateGroup"></select>
    </div>
  </div>

  <hr />

  <div class="layout">
    <div class="section left">
      <label>ğŸ“¦ å¸¸ç”¨æŒ‡ä»¤æ¨¡æ¿</label>
      <select id="templateSelect" onchange="applyTemplate()"></select>

      <label>âœï¸ æŒ‡ä»¤æ¨¡æ¿</label>
      <textarea id="template"></textarea>

      <div id="riskNote"></div>
    </div>

    <div class="section right">
      <label>èªªæ˜</label>
      <p id="commandDesc" style="margin-top: 8px; font-size: 13px; color: #555;"></p>
    </div>
  </div>

  <hr />

  <h3>ğŸ”£ è®Šæ•¸è¨­å®š</h3>
  <button onclick="addVar()">â• æ–°å¢è®Šæ•¸</button>

  <hr />
  <div id="vars"></div>

  <label>ğŸ”€ çµ„åˆæ–¹å¼</label>
  <select id="mode">
    <option value="cross">æ’åˆ—çµ„åˆï¼ˆå…¨éƒ¨çµ„åˆï¼‰</option>
    <option value="zip">ä¸€å°ä¸€å°æ‡‰</option>
  </select>

  <br /><br />

  <button onclick="generate()">ğŸš€ ç”¢ç”ŸæŒ‡ä»¤</button>
  <button onclick="copy()">ğŸ“‹ è¤‡è£½çµæœ</button>

  <h3>ğŸ“¤ ç”¢ç”Ÿçµæœ</h3>
  <pre id="output"></pre>

  <script>
    function addVar(name = '', value = '') {
      const div = document.createElement('div');
      div.className = 'var-block';
      div.innerHTML = `
        <label>è®Šæ•¸åç¨±</label>
        <input placeholder="ä¾‹å¦‚ ns / deployment" value="${name}">
        <label>è®Šæ•¸å€¼</label>
        <textarea placeholder="æ”¯æ´ é€—è™Ÿ / ç©ºæ ¼ / æ›è¡Œ">${value}</textarea>
        <button onclick="this.parentNode.remove()">âŒ åˆªé™¤</button>
      `;
      document.getElementById('vars').appendChild(div);
    }

    function splitInput(text) {
      return text
        .split(/[\s,]+/)
        .map(v => v.trim())
        .filter(Boolean);
    }

    function cartesian(arrays) {
      return arrays.reduce(
        (a, b) => a.flatMap(x => b.map(y => x.concat([y]))),
        [[]]
      );
    }

    function generate() {
      const template = document.getElementById('template').value;
      const blocks = document.querySelectorAll('.var-block');
      const names = [];
      const values = [];

      blocks.forEach(b => {
        const n = b.querySelector('input').value;
        const v = splitInput(b.querySelector('textarea').value);
        if (n && v.length) {
          names.push(n);
          values.push(v);
        }
      });

      const mode = document.getElementById('mode').value;
      const results = [];

      if (mode === 'cross') {
        cartesian(values).forEach(combo => {
          let cmd = template;
          combo.forEach((val, i) => {
            cmd = cmd.replace(new RegExp(`\\$\\{${names[i]}\\}`, 'g'), val);
          });
          results.push(cmd);
        });
      } else {
        const len = Math.min(...values.map(v => v.length));
        for (let i = 0; i < len; i++) {
          let cmd = template;
          names.forEach((n, idx) => {
            cmd = cmd.replace(
              new RegExp(`\\$\\{${n}\\}`, 'g'),
              values[idx][i]
            );
          });
          results.push(cmd);
        }
      }

      document.getElementById('output').textContent = results.join('\n');
    }

    function copy() {
      navigator.clipboard.writeText(
        document.getElementById('output').textContent
      );
      alert('å·²è¤‡è£½');
    }

    function applyTemplate() {
      const sel = document.getElementById('templateSelect');
      const opt = sel.options[sel.selectedIndex];

      document.getElementById('template').value = opt.value || '';
      document.getElementById('commandDesc').innerText =
        opt.dataset.desc || 'æœªå¡«å¯«èªªæ˜';

      const note = document.getElementById('riskNote');
      if (opt.dataset.risk === 'danger') {
        note.innerHTML =
          '<p class="danger">âš ï¸ æ­¤æŒ‡ä»¤æœƒå¯¦éš›å½±éŸ¿ç·šä¸Šè³‡æºï¼Œè«‹ç¢ºèªå¾Œå†åŸ·è¡Œ</p>';
      } else if (opt.dataset.risk === 'safe') {
        note.innerHTML =
          '<p class="safe">âœ… æ­¤æŒ‡ä»¤ç‚ºåªè®€æ“ä½œï¼Œä¸æœƒå½±éŸ¿ç·šä¸Š</p>';
      } else {
        note.innerHTML = '';
      }

      syncVarsFromTemplate();
    }

    function syncVarsFromTemplate() {
      const varsEl = document.getElementById('vars');
      varsEl.innerHTML = '';

      const template = document.getElementById('template').value;
      if (!template) return;

      const matches = [...template.matchAll(/\$\{(\w+)\}/g)];
      const uniqueVars = [...new Set(matches.map(m => m[1]))];

      uniqueVars.forEach(v => addVar(v));
    }

    function renderTemplateOptions(arr) {
      const select = document.getElementById('templateSelect');
      select.innerHTML = '';

      arr.forEach(item => {
        const opt = document.createElement('option');
        opt.textContent = item.label;
        opt.value = item.value;
        opt.dataset.risk = item.risk || '';
        opt.dataset.desc = item.desc || 'æœªå¡«å¯«èªªæ˜';
        select.appendChild(opt);
      });
    }

    const groupSelect = document.getElementById('templateGroup');

    function renderGroupSelect() {
      groupSelect.innerHTML = '';

      const placeholder = document.createElement('option');
      placeholder.textContent = 'æŒ‡ä»¤é›†';
      placeholder.disabled = true;
      placeholder.selected = true;
      groupSelect.appendChild(placeholder);

      Object.keys(ALL_TEMPLATE).forEach(key => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = key.replace('_TEMPLATE_CONFIG', '');
        groupSelect.appendChild(option);
      });
    }

    groupSelect.addEventListener('change', e => {
      const groupKey = e.target.value;
      if (ALL_TEMPLATE[groupKey]) {
        renderTemplateOptions(ALL_TEMPLATE[groupKey]);
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      renderGroupSelect();
      renderTemplateOptions(ALL_TEMPLATE['KUBECTL_TEMPLATE_CONFIG']);
    });
  </script>
</body>
</html>
