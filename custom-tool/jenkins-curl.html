<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Jenkins URL Builder</title>
  <style>
/* åŸºæœ¬é‡ç½® */
* {
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
               Roboto, "Noto Sans TC", Arial, sans-serif;
  background: #f5f7fa;
  color: #222;
  padding: 24px;
}

/* æ¨™é¡Œ */
h2 {
  margin-bottom: 20px;
}

/* æ•´é«”å·¦å³ç‰ˆé¢ */
.layout {
  display: flex;
  gap: 24px;
  align-items: flex-start;
}

/* å·¦å³é¢æ¿ */
.panel {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.panel-left {
  flex: 0 0 360px;
}

.panel-right {
  flex: 1;
}

/* å¡ç‰‡æ¨£å¼ */
.card {
  background: #fff;
  border-radius: 8px;
  padding: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}

/* å¡ç‰‡æ¨™é¡Œ */
.card h3 {
  margin: 0 0 12px;
  font-size: 16px;
}

/* è¡¨å–® */
label {
  display: block;
  font-size: 13px;
  margin: 10px 0 4px;
  color: #555;
}

select {
  width: 100%;
  padding: 6px 8px;
  border-radius: 4px;
  border: 1px solid #ccc;
}

/* checkbox å€ */
.options {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 6px;
  margin-top: 8px;
}

.options label {
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* pre è¼¸å‡º */
pre {
  background: #0f172a;
  color: #e5e7eb;
  padding: 12px;
  border-radius: 6px;
  overflow-x: auto;
  font-size: 12px;
  line-height: 1.4;
}

/* æŒ‰éˆ• */
button {
  margin: 8px 0;
  padding: 8px 14px;
  border: none;
  border-radius: 6px;
  background: #2563eb;
  color: white;
  font-size: 14px;
  cursor: pointer;
}

button:hover {
  background: #1e40af;
}

/* å¤šé¸çµæœå€ */
.result pre {
  margin-top: 10px;
  max-height: 360px;
}

  </style>
</head>
<body>
<h2>Jenkins Job URL ç”¢ç”Ÿå™¨</h2>

<div class="layout">

  <!-- å·¦å´ï¼šè¨­å®šé¢æ¿ -->
  <div class="panel panel-left">

    <section class="card">
      <h3>ğŸ› å–®ä¸€ Job è¨­å®š</h3>
      <input id="username" value="primo"></input>
      <input id="token" value="1123c8a9f17f0d51c7331b0e716e9d0542"></input>
      

      <label>åœ‹å®¶</label>
      <select id="country"></select>

      <label>æœå‹™é¡å‹</label>
      <select id="service"></select>

      <label>Job</label>
      <select id="job"></select>

      <label>ç’°å¢ƒ</label>
      <select id="env"></select>

      <label>Namespace</label>
      <select id="namespace"></select>
    </section>

    <section class="card">
      <h3>ğŸŒ å¤šåœ‹å®¶é¸æ“‡</h3>
      <label>åœ‹å®¶ï¼ˆå¯å¤šé¸ï¼‰</label>
      <div id="countryList" class="options"></div>
    </section>

  </div>

  <!-- å³å´ï¼šè¼¸å‡ºé¢æ¿ -->
  <div class="panel panel-right">

    <section class="card">
      <h3>ğŸ”— Jenkins URLï¼ˆå–®ä¸€ï¼‰</h3>

      <p>ç€è¦½ Jobï¼š</p>
      <pre id="viewUrl"></pre>

      <p>è§¸ç™¼å»ºç½®ï¼ˆbuildWithParametersï¼‰ï¼š</p>
      <pre id="buildUrl"></pre>
    </section>

    <section class="card result">
      <h3>ğŸ“¦ å¤šé¸ç”¢å‡ºï¼ˆå…±ç”¨è¨­å®š job envï¼‰</h3>
      <button id="generateBtn">ç”¢å‡º URL</button>
      <button onclick="copy()">ğŸ“‹ è¤‡è£½çµæœ</button>
      <pre id="output"></pre>
    </section>

  </div>

</div>



</body>
</html>
<script src="jenkins-curl-config.js"></script>
<script>


// ===== DOM =====
const token = document.getElementById('token');
const countrySelect = document.getElementById('country');
const serviceSelect = document.getElementById('service');
const jobSelect = document.getElementById('job');
const output = document.getElementById('output');
const envSelect = document.getElementById('env');
const nsSelect = document.getElementById('namespace');
const username = document.getElementById('username');

const countryList = document.getElementById("countryList");

const btn = document.getElementById("generateBtn");

// ===== åˆå§‹åŒ– =====
initCountries();
initServices();

initEnvironments();
initNamespaces();

updateJobs();
updateUrl();




// å¤šåœ‹å®¶
/* ===== render countries ===== */
Object.entries(config.countries).forEach(([key, c]) => {
  const label = document.createElement("label");
  label.innerHTML = `
    <input type="checkbox" value="${key}">
    ${c.name}
  `;
  countryList.appendChild(label);
});

/* ===== render services ===== */
/*
const services = config.jobs.deploy.services.pod.item;
services.forEach(svc => {
  const opt = document.createElement("option");
  opt.value = svc;
  opt.textContent = svc;
  serviceSelect.appendChild(opt);
});
*/

/* ===== URL builder ===== */
function buildViewURL(country, service) {
  return (
    config.jenkins.base_url +
    "job/" +
    country.jenkins.path +
    "/job/" +
    service +
    "/"
  );
}

function buildBuildURL(country, service, params) {
  const query = new URLSearchParams(params).toString();
  return (
    buildViewURL(country, service) +
    "buildWithParameters?" +
    query
  );
}

/* ===== click handler ===== */
btn.addEventListener("click", () => {
  const selectedCountries = [
    ...countryList.querySelectorAll("input:checked")
  ].map(i => i.value);

  const service = jobSelect.value;
  const envType = document.getElementById("env").value; // beta / release

  if (!selectedCountries.length) {
    output.textContent = "âš ï¸ è«‹é¸æ“‡è‡³å°‘ä¸€å€‹åœ‹å®¶";
    return;
  }

  let result = "";

  selectedCountries.forEach(code => {
    const country = config.countries[code];
    const env = country.environments[envType];

    if (!env) return; // è©²åœ‹å®¶æ²’æœ‰é€™å€‹ç’°å¢ƒå°±è·³é

    env.namespaces.forEach(ns => {
      const params = {
        //token: token.value,
        branch: envSelect.value,   // ä¸‹ä¸€æ­¥æœƒç”± branch_modes æ¥ç®¡
        namespace: ns
      };
      /*
      result += `# ${country.name} - ${env.label}\n`;
      result += `VIEW:\n${buildViewURL(country, service)}\n`;
      result += `BUILD:\n${buildBuildURL(country, service, params)}\n\n`;
      */
      result += `sleep 5\n`;
      result += `echo ${service} - ${params.namespace} - ${params.branch} - ${country.name} - ${env.label}\n`;
        /*
      result += `curl -I -X POST `;
      result += ` -u ${username.value}:${token.value} `;
      result += `"${buildBuildURL(country, service, params)}"\n`;
   */
    });
  });

  output.textContent = result;
});

//


// ===== functions =====
function initCountries() {
  Object.entries(config.countries).forEach(([key, c]) => {
    countrySelect.add(new Option(c.name, key));
  });
}

function initServices() {
  Object.entries(config.jobs.deploy.services).forEach(([key, s]) => {
    serviceSelect.add(new Option(s.desc, key));
  });
}

function updateJobs() {
  jobSelect.innerHTML = '';
  const service = serviceSelect.value;
  const items = config.jobs.deploy.services[service].item;

  items.forEach(job => {
    jobSelect.add(new Option(job, job));
  });
}

function updateUrlz() {
    
    /*
  const country = countrySelect.value;
  const service = serviceSelect.value;
  const job = jobSelect.value;

  const url =
    `${config.jenkins.base_url}` +
    `/job/${config.countries[country].jenkins.path}` +
    `/job/${job}/`;

  output.textContent = url;
  */
}

//two url//
function buildViewUrl() {
  const country = countrySelect.value;
  const job = jobSelect.value;

  return (
    config.jenkins.base_url +
    'job/' +
    config.countries[country].jenkins.path +
    '/job/' +
    job +
    '/'
  );
}

function buildTriggerUrl() {
  const country = countrySelect.value;
  const env = envSelect.value;
  const namespace = nsSelect.value;
  const job = jobSelect.value;

  const branch = getBranchByEnv(country, env);

  const params = new URLSearchParams({
    //token: token.value,
    branch: branch,
    namespace: namespace
  });

  return (
   //'test/' +
    `curl -I -X POST -u ${username.value}:${token.value} "`+
    config.jenkins.base_url +
    'job/' +
    config.countries[country].jenkins.path +
    '/job/' +
    job +
    '/buildWithParameters?' +
    params.toString()
    +'"'
  );
}


function updateUrl() {
  document.getElementById('viewUrl').textContent = buildViewUrl();
  document.getElementById('buildUrl').textContent = buildTriggerUrl();
}
//
//env-type//
function getBranchByEnv(countryCode, envKey) {
  return config.countries[countryCode]
    .environments[envKey]
    .type;
}


//
////

// ===== events =====
serviceSelect.addEventListener('change', () => {
  updateJobs();
  updateUrl();
});

countrySelect.addEventListener('change', updateUrl);
jobSelect.addEventListener('change', updateUrl);
envSelect.addEventListener('change', updateUrl);
nsSelect.addEventListener('change', updateUrl);


// =====  =====

function initEnvironments() {
  envSelect.innerHTML = '';
  const country = countrySelect.value;
  const envs = config.countries[country].environments;

  Object.entries(envs).forEach(([key, env]) => {
    envSelect.add(new Option(env.label, key));
  });
}

function initNamespaces() {
  nsSelect.innerHTML = '';
  const country = countrySelect.value;
  const env = envSelect.value;

  const namespaces =
    config.countries[country].environments[env].namespaces;

  namespaces.forEach(ns => {
    nsSelect.add(new Option(ns, ns));
  });
}

function updateUrlo() {
  const country = countrySelect.value;
  const service = serviceSelect.value;
  const job = jobSelect.value;

  const url =
    `${config.jenkins.base_url}` +
    `/job/${config.countries[country].jenkins.path}` +
    `/job/${job}/`;

  output.textContent = url;
}



countrySelect.addEventListener('change', () => {
  initEnvironments();
  initNamespaces();
  updateUrl();
});

envSelect.addEventListener('change', () => {
  initNamespaces();
});

serviceSelect.addEventListener('change', () => {
  updateJobs();
  updateUrl();
});

envSelect.addEventListener('change', () => {
  //updateJobs();
  updateUrl();
});

nsSelect.addEventListener('change', () => {
  //updateJobs();
  updateUrl();
});

jobSelect.addEventListener('change', updateUrl);

token.addEventListener('change', () => {
 const token = document.getElementById('token');
});


function copy() {
  navigator.clipboard.writeText(
    document.getElementById('output').textContent
  );
  alert('å·²è¤‡è£½');
}
// =====  =====
//curl -X POST -u primo:1123c8a9f17f0d51c7331b0e716e9d0542 "https://jenkins.yq-ops.top/job/test/buildWithParameters?aa=b"

</script>