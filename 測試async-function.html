
<style>
/* å…¨å±€ */
* {
  box-sizing: border-box;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

html, body {
  margin: 0;
  height: 100%;
  background: #0f172a; /* æ·±è‰²ï¼Œåƒ Jenkins console */
  color: #e5e7eb;
}

/* App Layout */
.app {
  display: flex;
  flex-direction: column;
  height: 100vh;
}

/* ä¸Šæ–¹æ§åˆ¶å€ */
.control {
  display: flex;
  gap: 8px;
  padding: 10px;
  background: #020617;
  border-bottom: 1px solid #1e293b;
}

.control button {
  flex-shrink: 0;
  padding: 10px 14px;
  background: #22c55e;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
}

.control input {
  flex: 1;
  padding: 10px;
  border-radius: 8px;
  border: none;
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #334155;
}

/* ç‹€æ…‹å€ */
.stats {
  padding: 8px 12px;
  background: #020617;
  font-size: 14px;
  border-bottom: 1px solid #1e293b;
}

/* Log å€ï¼ˆé‡é»ï¼‰ */
.log {
  flex: 1;
  padding: 8px;
}

#writee {
  width: 100%;
  height: 100%;
  resize: none;
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #1e293b;
  border-radius: 8px;
  padding: 10px;
  font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
  font-size: 13px;
  line-height: 1.4;
  overflow-y: auto;
}

/* æ¡Œæ©Ÿå„ªåŒ–ï¼ˆå¯¬è¢å¹•ï¼‰
@media (min-width: 900px) {
  .control {
    max-width: 900px;
    margin: 0 auto;
  }

  .stats,
  .log {
    max-width: 900px;
    margin: 0 auto;
  }
}
 */
</style>

<div class="app">
  <header class="control">
    <button onclick="pipeline()">é–‹å§‹</button>
    <input id="setrun" value="2" placeholder="å¤§æ–¼é€™å€‹æ•¸æ‰æˆåŠŸ">
    <input id="restnum" value="5" placeholder="æ¸…ç‰ˆ">
  </header>

  <section class="stats">
    <p id="calccount">è´ ï¼š0 è¼¸ï¼š 0 è¼¸è´å…±è¨ˆï¼š0 ç¸½å€«æ¬¡ï¼š0 æ¸…ç‰ˆï¼š0</p>
  </section>

  <section class="log">
    <textarea id="writee" readonly></textarea>
  </section>
</div>


<script>
const writee = document.getElementById('writee');
const calccount = document.getElementById('calccount');
let restcount=0;
let momeycount=0;
let lostcount=0;
function step(name, ms) {
  return new Promise((resolve, reject) => {
    const r = Math.floor(Math.random() * 10); // 0â€“9

    writee.textContent += `é–‹å§‹ ${name}ï¼ˆäº‚æ•¸=${r}ï¼‰\n`;
    //console.log(`é–‹å§‹ ${name}ï¼ˆäº‚æ•¸=${r}ï¼‰`);

    setTimeout(() => {
      if (r < document.getElementById('setrun').value) {
        writee.textContent += `âŒ å¤±æ•— ${name}\n`;
        scrollLog();
        //console.error(`å¤±æ•— ${name}`);
        reject(new Error(`${name} éƒ¨ç½²å¤±æ•—`));   // â¬…ï¸ ä¸­æ–·é»
      } else {
        writee.textContent += `âœ… å®Œæˆ ${name}\n`;
        scrollLog();
        //console.log(`å®Œæˆ ${name}`);
        resolve(name);
      }
    }, ms);
  });
}

function rest(){
    restcount++;
    if (restcount>document.getElementById('restnum').value &&  document.getElementById('restnum').value!=0) {
        writee.textContent=""
        restcount=0;
    }
    //writee.textContent+="count"+restcount+"\n";
}

function scrollLog() {
  writee.scrollTop = writee.scrollHeight;
}


async function pipeline() {
 rest()

  const timed = new Date();
  writee.textContent += `ğŸš€ pipeline start: ${timed}\n`;

  try {
    await step("step1: checkout", 2000);
    await step("step2: build", 3000);
    await step("step3: deploy", 1600);
    writee.textContent += `ğŸ‰ pipeline done\n`;
   // console.log("ğŸ‰ pipeline done");
    momeycount++;
  } catch (err) {
    writee.textContent += `ğŸ›‘ pipeline aborted: ${err.message}\n`;
    //console.error("pipeline aborted", err);
    lostcount++;
  }finally{
    pipeline();
    calccount.textContent = `è´ ï¼š${momeycount} è¼¸ï¼š ${lostcount} è¼¸è´å…±è¨ˆï¼š${momeycount-lostcount} ç¸½å€«æ¬¡ï¼š${momeycount+lostcount} æ¸…ç‰ˆï¼š${restcount}`;
    
  }
}

//pipeline();


</script>